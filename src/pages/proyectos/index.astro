---
import Layout from '../../layouts/Layout.astro';
import { db } from '../../lib/db';
// import FadeInOnScroll from '../../components/FadeInOnScroll.astro'; // Desactivado

let projects = [];
let error = null;

try {
  const result = await db.query(`
    SELECT 
      title,
      description,
      url,
      image_url,
      LOWER(REPLACE(title, ' ', '-')) as slug
    FROM repositories 
    ORDER BY created_at DESC;
  `);
  projects = result.rows;
  console.log("Proyectos obtenidos:", projects);
} catch (e) {
  error = e.message;
  console.error("Error al obtener proyectos:", error);
}
---

<Layout title="Proyectos - Mi Portafolio">
  <main>
    <h1>Mis Proyectos</h1>
    {error ? (
      <p>Error al cargar los proyectos: {error}</p>
    ) : (
      <div class="project-list">
        {
          projects.length > 0 ? (
            projects.map((project, index) => (
              // <FadeInOnScroll delay={index * 100}> {/* Desactivado */}
                <article>
                  {project.image_url && <img src={project.image_url} alt={project.title} class="project-image" />}
                  <h2><a href={`/proyectos/${project.slug}`}>{project.title}</a></h2>
                  <p>{project.description}</p>
                  {project.url && <a href={project.url} target="_blank" rel="noopener noreferrer" class="repo-link">Ver en GitHub</a>}
                </article>
              // </FadeInOnScroll> // Desactivado
            ))
          ) : (
            <p>No hay proyectos disponibles.</p>
          )
        }
      </div>
    )}
  </main>
</Layout>

<style>
  .project-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }
  .project-list article {
    background-color: #1a1a1a;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
  }
  .project-list article:hover {
    transform: translateY(-5px);
  }
  .project-list article h2 {
    margin-top: 0;
  }
  .project-list article h2 a {
    color: #00bcd4;
    text-decoration: none;
  }
  .project-list article h2 a:hover {
    text-decoration: underline;
  }
  .project-image {
    width: 100%;
    height: 200px; /* Altura fija para las imágenes */
    object-fit: cover; /* Asegura que la imagen cubra el área sin distorsionarse */
    border-radius: 4px;
    margin-bottom: 1rem;
  }
  .repo-link {
    display: inline-block;
    margin-top: 1rem;
    padding: 0.5rem 1rem;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    transition: background-color 0.3s ease;
  }
  .repo-link:hover {
    background-color: #0056b3;
  }
</style>
